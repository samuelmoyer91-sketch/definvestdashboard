<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aerospace & Defense ETF (ITA) - Defense Capital Dashboard</title>
    <link rel="stylesheet" href="../css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <nav>
        <div class="container">
            <a href="../index.html" class="logo">Defense Capital Dashboard</a>
            <button class="mobile-menu-toggle">☰</button>
            <ul>
                <li><a href="../index.html">Home</a></li>
                <li><a href="../deals/index.html">Deal Tracker</a></li>
                <li><a href="../charts/defense-investment.html" >Defense Investment Trends</a></li>
                <li><a href="../charts/defense-industrial.html" class="active">Defense Industrial Health</a></li>
                <li><a href="../charts/us-industrial.html" >Overall US Industrial Health</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="page-header">
            <h1>Aerospace & Defense ETF (ITA)</h1>
            <p>iShares U.S. Aerospace & Defense ETF investor sentiment</p>
            <p class="last-updated" id="lastUpdated"></p>
        </div>

        <!-- Data Summary Stats -->
        <div class="data-summary" id="dataSummary" style="display: none;">
            <div class="summary-grid">
                <div class="summary-item">
                    <div class="summary-label">Latest Value</div>
                    <div class="summary-value" id="latestValue">--</div>
                    <div class="summary-change" id="latestDate">--</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Period Change</div>
                    <div class="summary-value" id="monthChange">--</div>
                    <div class="summary-change" id="monthChangePercent">--</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Year-over-Year</div>
                    <div class="summary-value" id="yearChange">--</div>
                    <div class="summary-change" id="yearChangePercent">--</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Trend</div>
                    <div class="summary-value"><span id="trendIndicator" class="trend-indicator">→</span></div>
                    <div class="summary-change">Recent direction</div>
                </div>
            </div>
        </div>

        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h2 style="margin: 0;">Chart</h2>
                <button class="btn btn-download" id="downloadBtn">Download CSV</button>
            </div>
            <div class="chart-container" style="height: 500px;">
                <canvas id="mainChart"></canvas>
            </div>
        </div>

        <div class="card">
            <h2>About This Metric</h2>
            <p>
            The <strong>iShares U.S. Aerospace & Defense ETF (ITA)</strong> tracks ETFs focused on the aerospace and defense
            sectors, reflecting investor sentiment. It is a basket of stocks of companies in the defense industrial base.
        </p>
            <p>
            Higher ITA prices demonstrate that investors believe the value of defense primes will increase, while lower prices
            suggest caution towards the growth of the defense industrial base. The ETF serves as a real-time measure of market
            confidence in the sector's future profitability and growth prospects.
        </p>
            <p><strong>Units:</strong> Price (USD)</p>
            <p><strong>Source:</strong> Yahoo Finance</p>
        </div>

        <div class="card">
            <h2>Related Charts</h2>
            <div class="grid grid-3">
                <a href="aircraft-orders.html" class="btn btn-secondary">Defense Aircraft Orders</a>
                <a href="aircraft-parts-orders.html" class="btn btn-secondary">Defense Aircraft Parts Orders</a>
                <a href="manufacturing-production.html" class="btn btn-secondary">Industrial Production: Defense Equipment</a>
            </div>
        </div>
    </div>

    <footer>
        <p>Defense Capital Dashboard</p>
        <p>Data source: Yahoo Finance</p>
    </footer>

    <script src="../js/main.js"></script>
    <script>
        let chartData = null;

        document.addEventListener('DOMContentLoaded', async function() {
            try {
                // Load data
                const response = await fetch('../data/ita.json');
                chartData = await response.json();

                // Calculate and display stats
                const stats = ChartUtils.calculateStats(chartData.data);
                if (stats) {
                    document.getElementById('dataSummary').style.display = 'block';
                    document.getElementById('latestValue').textContent = ChartUtils.formatNumber(stats.latest.toFixed(2));
                    document.getElementById('latestDate').textContent = stats.latestDate;

                    if (stats.monthChange !== null) {
                        const monthChangeElem = document.getElementById('monthChange');
                        const monthChangePercentElem = document.getElementById('monthChangePercent');
                        monthChangeElem.textContent = (stats.monthChange >= 0 ? '+' : '') + ChartUtils.formatNumber(stats.monthChange.toFixed(2));
                        monthChangePercentElem.textContent = (stats.monthChangePercent >= 0 ? '+' : '') + stats.monthChangePercent.toFixed(2) + '%';
                        monthChangePercentElem.className = 'summary-change ' + (stats.monthChangePercent > 0 ? 'positive' : stats.monthChangePercent < 0 ? 'negative' : 'neutral');
                    }

                    const yearChangeElem = document.getElementById('yearChange');
                    const yearChangePercentElem = document.getElementById('yearChangePercent');
                    yearChangeElem.textContent = (stats.yearChange >= 0 ? '+' : '') + ChartUtils.formatNumber(stats.yearChange.toFixed(2));
                    yearChangePercentElem.textContent = (stats.yearChangePercent >= 0 ? '+' : '') + stats.yearChangePercent.toFixed(2) + '%';
                    yearChangePercentElem.className = 'summary-change ' + (stats.yearChangePercent > 0 ? 'positive' : stats.yearChangePercent < 0 ? 'negative' : 'neutral');

                    document.getElementById('trendIndicator').textContent = stats.trend;
                }

                // Display last updated
                if (chartData.last_updated) {
                    document.getElementById('lastUpdated').textContent = 'Last updated: ' + chartData.last_updated;
                }

                // Filter data to 2019-present for consistent visualization
                // Exception: Annual investment charts (VC, M&A, PDC) show all available data
                const limitedDataCharts = ['public_defense_companies', 'vc_defense', 'ma_defense'];
                let displayData = chartData;

                if (!limitedDataCharts.includes('ita')) {
                    const filteredData = chartData.data.filter(d => new Date(d.date) >= new Date('2019-01-01'));
                    if (filteredData.length > 0) {
                        displayData = {
                            ...chartData,
                            data: filteredData
                        };
                    }
                }

                // Create quarterly labels from the filtered data
                const quarterlyLabels = displayData.data.map(d => {
                    const date = new Date(d.date);
                    const year = date.getFullYear();
                    const month = date.getMonth();
                    const quarter = Math.floor(month / 3) + 1;
                    return `${year} Q${quarter}`;
                });

                // Modify displayData to include quarterly labels
                displayData = {
                    ...displayData,
                    quarterlyLabels: quarterlyLabels
                };

                // Render chart with quarterly labels and gridlines
                const chartOptions = {
                    fill: true,
                    scales: {
                        x: {
                            grid: {
                                display: true,
                                color: function(context) {
                                    // Get the date for this gridline
                                    const dataPoint = displayData.data[context.index];
                                    if (!dataPoint) return '#e0e0e0';

                                    const date = new Date(dataPoint.date);
                                    const month = date.getMonth();

                                    // Heavier line for January (start of year)
                                    if (month === 0) {
                                        return '#999999';
                                    }
                                    // Lighter lines for quarters
                                    if (month % 3 === 0) {
                                        return '#cccccc';
                                    }
                                    return '#e8e8e8';
                                },
                                lineWidth: function(context) {
                                    const dataPoint = displayData.data[context.index];
                                    if (!dataPoint) return 1;

                                    const date = new Date(dataPoint.date);
                                    const month = date.getMonth();

                                    // Thicker line for January
                                    return (month === 0) ? 2 : 1;
                                }
                            },
                            ticks: {
                                autoSkip: true,
                                maxRotation: 45,
                                minRotation: 45,
                                maxTicksLimit: 20,
                                callback: function(value, index, ticks) {
                                    return displayData.quarterlyLabels[value] || '';
                                }
                            }
                        },
                        y: {
                            // Start at zero for investment/dollar amount charts
                            beginAtZero: ['public_defense_companies', 'vc_defense', 'ma_defense', 'dgorder', 'fdefx', 'pnfi', 'gpdi', 'prmfgcons', 'adefno', 'adapno'].includes('ita'),
                            ticks: {
                                callback: function(value) {
                                    const formats = {'prefix': '$', 'suffix': '', 'divisor': 1};
                                    const displayValue = value / formats.divisor;
                                    return formats.prefix + displayValue.toLocaleString() + formats.suffix;
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Value: ${context.parsed.y.toFixed(2)}`;
                                }
                            }
                        }
                    }
                };

                ChartUtils.createLineChart('mainChart', displayData, chartOptions);
            } catch (error) {
                console.error('Error loading chart:', error);
            }

            // Download button handler
            document.getElementById('downloadBtn').addEventListener('click', function() {
                if (chartData) {
                    ChartUtils.downloadCSV(chartData, 'ita.csv');
                }
            });
        });
    </script>
</body>
</html>