<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Industrial Production: Defense Equipment - Defense Capital Dashboard</title>
    <link rel="stylesheet" href="../css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <nav>
        <div class="container">
            <a href="../index.html" class="logo">Defense Capital Dashboard</a>
            <button class="mobile-menu-toggle">☰</button>
            <ul>
                <li><a href="../index.html">Home</a></li>
                <li><a href="../deals/index.html">Deal Tracker</a></li>
                <li><a href="../charts/defense-investment.html" >Defense Investment Trends</a></li>
                <li><a href="../charts/defense-industrial.html" class="active">Defense Industrial Health</a></li>
                <li><a href="../charts/us-industrial.html" >Overall US Industrial Health</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="page-header">
            <h1>Industrial Production: Defense Equipment</h1>
            <p>Production output of defense and space equipment</p>
            <p class="last-updated" id="lastUpdated"></p>
        </div>

        <!-- Data Summary Stats -->
        <div class="data-summary" id="dataSummary" style="display: none;">
            <div class="summary-grid">
                <div class="summary-item">
                    <div class="summary-label">Latest Value</div>
                    <div class="summary-value" id="latestValue">--</div>
                    <div class="summary-change" id="latestDate">--</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Period Change</div>
                    <div class="summary-value" id="monthChange">--</div>
                    <div class="summary-change" id="monthChangePercent">--</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Year-over-Year</div>
                    <div class="summary-value" id="yearChange">--</div>
                    <div class="summary-change" id="yearChangePercent">--</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Trend</div>
                    <div class="summary-value"><span id="trendIndicator" class="trend-indicator">→</span></div>
                    <div class="summary-change">Recent direction</div>
                </div>
            </div>
        </div>

        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h2 style="margin: 0;">Chart</h2>
                <button class="btn btn-download" id="downloadBtn">Download CSV</button>
            </div>
            <div class="chart-container" style="height: 500px;">
                <canvas id="mainChart"></canvas>
            </div>
        </div>

        <div class="card">
            <h2>About This Metric</h2>
            <p>
            The data set <strong>"Equipment: Defense and Space Equipment"</strong> measures how much the U.S. is producing in terms
            of military and space-related technology and machinery. Tracked monthly by the Federal Reserve, this index reflects the
            real output of U.S.-based manufacturers that build everything from weapons systems and armored vehicles to satellites
            and space launch components.
        </p>
            <p>
            By following this index, we get a clearer picture of the production capacity of the US defense industrial base. Rising
            production indicates manufacturers are actively building defense systems, while declining production may signal slower
            procurement or capacity constraints.
        </p>
            <p><strong>Units:</strong> Index 2017=100</p>
            <p><strong>Source:</strong> Federal Reserve Economic Data (FRED)</p>
        </div>

        <div class="card">
            <h2>Related Charts</h2>
            <div class="grid grid-3">
                <a href="aircraft-orders.html" class="btn btn-secondary">Defense Aircraft Orders</a>
                <a href="aircraft-parts-orders.html" class="btn btn-secondary">Defense Aircraft Parts Orders</a>
                <a href="defense-spending.html" class="btn btn-secondary">National Defense Spending</a>
            </div>
        </div>
    </div>

    <footer>
        <p>Defense Capital Dashboard</p>
        <p>Data source: Federal Reserve Economic Data (FRED)</p>
    </footer>

    <script src="../js/main.js"></script>
    <script>
        let chartData = null;

        document.addEventListener('DOMContentLoaded', async function() {
            try {
                // Load data
                const response = await fetch('../data/ipb52300s.json');
                chartData = await response.json();

                // Calculate and display stats
                const stats = ChartUtils.calculateStats(chartData.data);
                if (stats) {
                    document.getElementById('dataSummary').style.display = 'block';
                    document.getElementById('latestValue').textContent = ChartUtils.formatNumber(stats.latest.toFixed(2));
                    document.getElementById('latestDate').textContent = stats.latestDate;

                    if (stats.monthChange !== null) {
                        const monthChangeElem = document.getElementById('monthChange');
                        const monthChangePercentElem = document.getElementById('monthChangePercent');
                        monthChangeElem.textContent = (stats.monthChange >= 0 ? '+' : '') + ChartUtils.formatNumber(stats.monthChange.toFixed(2));
                        monthChangePercentElem.textContent = (stats.monthChangePercent >= 0 ? '+' : '') + stats.monthChangePercent.toFixed(2) + '%';
                        monthChangePercentElem.className = 'summary-change ' + (stats.monthChangePercent > 0 ? 'positive' : stats.monthChangePercent < 0 ? 'negative' : 'neutral');
                    }

                    const yearChangeElem = document.getElementById('yearChange');
                    const yearChangePercentElem = document.getElementById('yearChangePercent');
                    yearChangeElem.textContent = (stats.yearChange >= 0 ? '+' : '') + ChartUtils.formatNumber(stats.yearChange.toFixed(2));
                    yearChangePercentElem.textContent = (stats.yearChangePercent >= 0 ? '+' : '') + stats.yearChangePercent.toFixed(2) + '%';
                    yearChangePercentElem.className = 'summary-change ' + (stats.yearChangePercent > 0 ? 'positive' : stats.yearChangePercent < 0 ? 'negative' : 'neutral');

                    document.getElementById('trendIndicator').textContent = stats.trend;
                }

                // Display last updated
                if (chartData.last_updated) {
                    document.getElementById('lastUpdated').textContent = 'Last updated: ' + chartData.last_updated;
                }

                // Render chart using already-loaded data
                ChartUtils.createLineChart('mainChart', chartData, {
                    fill: true,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Value: ${context.parsed.y.toFixed(2)}`;
                                }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Error loading chart:', error);
            }

            // Download button handler
            document.getElementById('downloadBtn').addEventListener('click', function() {
                if (chartData) {
                    ChartUtils.downloadCSV(chartData, 'ipb52300s.csv');
                }
            });
        });
    </script>
</body>
</html>