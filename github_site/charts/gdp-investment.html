<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GDP Investment Component - Defense Capital Dashboard</title>
    <link rel="stylesheet" href="../css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <nav>
        <div class="container">
            <a href="../index.html" class="logo">Defense Capital Dashboard</a>
            <button class="mobile-menu-toggle">☰</button>
            <ul>
                <li><a href="../index.html">Home</a></li>
                <li><a href="../deals/index.html">Deal Tracker</a></li>
                <li><a href="../charts/defense-investment.html" >Defense Investment Trends</a></li>
                <li><a href="../charts/defense-industrial.html" >Defense Industrial Health</a></li>
                <li><a href="../charts/us-industrial.html" class="active">Overall US Industrial Health</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="page-header">
            <h1>GDP Investment Component</h1>
            <p>Gross private domestic investment</p>
            <p style="margin-top: 0.5rem; font-size: 0.9rem; color: #666;">
                Source: <a href="#" target="_blank" rel="noopener" style="color: #226E93; text-decoration: none;">Federal Reserve Economic Data (FRED)</a>
            </p>
            <p class="last-updated" id="lastUpdated"></p>
        </div>

        <div class="card">
            <div class="chart-container" style="height: 500px;">
                <canvas id="mainChart"></canvas>
            </div>
        </div>

        <!-- Data Summary Stats -->
        <div class="data-summary" id="dataSummary" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                <h2 style="margin: 0;">Key Statistics</h2>
                <button class="btn btn-download" id="downloadBtn">Download CSV</button>
            </div>
            <div class="summary-grid">
                <div class="summary-item">
                    <div class="summary-label">Latest Value</div>
                    <div class="summary-value" id="latestValue">--</div>
                    <div class="summary-change" id="latestDate">--</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Period Change</div>
                    <div class="summary-value" id="monthChange">--</div>
                    <div class="summary-change" id="monthChangePercent">--</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Year-over-Year</div>
                    <div class="summary-value" id="yearChange">--</div>
                    <div class="summary-change" id="yearChangePercent">--</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Trend</div>
                    <div class="summary-value"><span id="trendIndicator" class="trend-indicator">→</span></div>
                    <div class="summary-change">Recent direction</div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>About This Metric</h2>
            <p>
            Gross Private Domestic Investment (GPDI) measures business investment, residential
            investment, and changes in private inventories. This is a major component of GDP
            and represents the total investment activity in the economy.
        </p>
            <p>
            This component of GDP reflects overall investment activity in the economy. Strong investment indicates business
            confidence and capacity expansion, supporting defense industrial base growth. It captures the broader investment
            climate that enables or constrains defense manufacturing expansion.
        </p>
            <p style="margin-top: 1rem; color: #666; font-size: 0.9rem;">Units: Billions of Dollars</p>
        </div>

        <div class="card">
            <h2>Related Charts</h2>
            <div class="grid grid-3">
                <a href="industrial-production.html" class="btn btn-secondary">Industrial Production Index</a>
                <a href="investment-trends.html" class="btn btn-secondary">Business Investment Trends</a>
                <a href="lending-standards.html" class="btn btn-secondary">Bank Lending Standards</a>
            </div>
        </div>
    </div>

    <footer>
        <p>Defense Capital Dashboard</p>
        <p>Data source: Federal Reserve Economic Data (FRED)</p>
    </footer>

    <script src="../js/main.js"></script>
    <script>
        let chartData = null;

        document.addEventListener('DOMContentLoaded', async function() {
            try {
                // Load data
                const response = await fetch('../data/gpdi.json');
                chartData = await response.json();

                // Calculate and display stats
                const stats = ChartUtils.calculateStats(chartData.data);
                if (stats) {
                    document.getElementById('dataSummary').style.display = 'block';
                    document.getElementById('latestValue').textContent = ChartUtils.formatNumber(stats.latest.toFixed(2));
                    document.getElementById('latestDate').textContent = stats.latestDate;

                    if (stats.monthChange !== null) {
                        const monthChangeElem = document.getElementById('monthChange');
                        const monthChangePercentElem = document.getElementById('monthChangePercent');
                        monthChangeElem.textContent = (stats.monthChange >= 0 ? '+' : '') + ChartUtils.formatNumber(stats.monthChange.toFixed(2));
                        monthChangePercentElem.textContent = (stats.monthChangePercent >= 0 ? '+' : '') + stats.monthChangePercent.toFixed(2) + '%';
                        monthChangePercentElem.className = 'summary-change ' + (stats.monthChangePercent > 0 ? 'positive' : stats.monthChangePercent < 0 ? 'negative' : 'neutral');
                    }

                    const yearChangeElem = document.getElementById('yearChange');
                    const yearChangePercentElem = document.getElementById('yearChangePercent');
                    yearChangeElem.textContent = (stats.yearChange >= 0 ? '+' : '') + ChartUtils.formatNumber(stats.yearChange.toFixed(2));
                    yearChangePercentElem.textContent = (stats.yearChangePercent >= 0 ? '+' : '') + stats.yearChangePercent.toFixed(2) + '%';
                    yearChangePercentElem.className = 'summary-change ' + (stats.yearChangePercent > 0 ? 'positive' : stats.yearChangePercent < 0 ? 'negative' : 'neutral');

                    document.getElementById('trendIndicator').textContent = stats.trend;
                }

                // Display last updated
                if (chartData.last_updated) {
                    document.getElementById('lastUpdated').textContent = 'Last updated: ' + chartData.last_updated;
                }

                // Filter data to 2019-present for consistent visualization
                // Exception: Annual investment charts (VC, M&A, PDC) show all available data
                const limitedDataCharts = ['public_defense_companies', 'vc_defense', 'ma_defense'];
                let displayData = chartData;

                if (!limitedDataCharts.includes('gpdi')) {
                    const filteredData = chartData.data.filter(d => new Date(d.date) >= new Date('2019-01-01'));
                    if (filteredData.length > 0) {
                        displayData = {
                            ...chartData,
                            data: filteredData
                        };
                    }
                }

                // Create year labels from the filtered data
                const yearLabels = displayData.data.map(d => {
                    const date = new Date(d.date);
                    const year = date.getFullYear();
                    return `${year}`;
                });

                // Modify displayData to include year labels
                displayData = {
                    ...displayData,
                    yearLabels: yearLabels
                };

                // Render chart with year labels and gridlines
                const chartOptions = {
                    fill: true,
                    scales: {
                        x: {
                            grid: {
                                display: true,
                                color: '#e0e0e0'
                            },
                            ticks: {
                                autoSkip: true,
                                maxRotation: 45,
                                minRotation: 45,
                                maxTicksLimit: 20
                            }
                        },
                        y: {
                            // Start at zero for investment/dollar amount charts
                            beginAtZero: ['public_defense_companies', 'vc_defense', 'ma_defense', 'dgorder', 'fdefx', 'pnfi', 'gpdi', 'prmfgcons', 'adefno', 'adapno'].includes('gpdi'),
                            ticks: {
                                callback: function(value) {
                                    const formats = {'prefix': '$', 'suffix': 'T', 'divisor': 1000};
                                    const displayValue = value / formats.divisor;
                                    return formats.prefix + displayValue.toLocaleString() + formats.suffix;
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Value: ${context.parsed.y.toFixed(2)}`;
                                }
                            }
                        }
                    }
                };

                ChartUtils.createLineChart('mainChart', displayData, chartOptions);
            } catch (error) {
                console.error('Error loading chart:', error);
            }

            // Download button handler
            document.getElementById('downloadBtn').addEventListener('click', function() {
                if (chartData) {
                    ChartUtils.downloadCSV(chartData, 'gpdi.csv');
                }
            });
        });
    </script>
</body>
</html>