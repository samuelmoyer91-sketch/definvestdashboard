<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Venture Capital Investment in Defense - Defense Capital Dashboard</title>
    <link rel="stylesheet" href="../css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <nav>
        <div class="container">
            <a href="../index.html" class="logo">Defense Capital Dashboard</a>
            <button class="mobile-menu-toggle">☰</button>
            <ul>
                <li><a href="../index.html">Home</a></li>
                <li><a href="../deals/index.html">Deal Tracker</a></li>
                <li><a href="../charts/defense-investment.html" class="active">Defense Investment Trends</a></li>
                <li><a href="../charts/defense-industrial.html" >Defense Industrial Health</a></li>
                <li><a href="../charts/us-industrial.html" >Overall US Industrial Health</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="page-header">
            <h1>Venture Capital Investment in Defense</h1>
            <p>Annual VC investment in defense and dual-use companies</p>
            <p class="last-updated" id="lastUpdated"></p>
        </div>

        <!-- Data Summary Stats -->
        <div class="data-summary" id="dataSummary" style="display: none;">
            <div class="summary-grid">
                <div class="summary-item">
                    <div class="summary-label">Latest Value</div>
                    <div class="summary-value" id="latestValue">--</div>
                    <div class="summary-change" id="latestDate">--</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Period Change</div>
                    <div class="summary-value" id="monthChange">--</div>
                    <div class="summary-change" id="monthChangePercent">--</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Year-over-Year</div>
                    <div class="summary-value" id="yearChange">--</div>
                    <div class="summary-change" id="yearChangePercent">--</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Trend</div>
                    <div class="summary-value"><span id="trendIndicator" class="trend-indicator">→</span></div>
                    <div class="summary-change">Recent direction</div>
                </div>
            </div>
        </div>

        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h2 style="margin: 0;">Chart</h2>
                <button class="btn btn-download" id="downloadBtn">Download CSV</button>
            </div>
            <div class="chart-container" style="height: 500px;">
                <canvas id="mainChart"></canvas>
            </div>
        </div>

        <div class="card">
            <h2>About This Metric</h2>
            <p>
            <strong>Venture Capital Investment in Defense</strong> tracks the volume of venture capital dollars flowing into U.S.
            defense-focused and dual-use companies. This data is updated annually and reflects early-stage investment activity
            in defense technology and innovation.
        </p>
            <p>
            Venture capital funding is a leading indicator of innovation and emerging technologies in the defense sector. Rising VC
            investment suggests strong investor interest in defense tech startups, often in areas like AI, cybersecurity, autonomous
            systems, and space. This capital fuels the next generation of defense capabilities and can signal where the market sees
            future growth opportunities.
        </p>
            <p><strong>Units:</strong> Billions of Dollars</p>
            <p><strong>Source:</strong> Federal Reserve Economic Data (FRED)</p>
        </div>

        <div class="card">
            <h2>Related Charts</h2>
            <div class="grid grid-3">
                <a href="defense-goods-orders.html" class="btn btn-secondary">Defense Capital Goods Orders</a>
                <a href="public-defense-companies.html" class="btn btn-secondary">Public Defense Companies - Capex & R&D</a>
                <a href="ma-activity.html" class="btn btn-secondary">M&A Activity in Defense</a>
            </div>
        </div>
    </div>

    <footer>
        <p>Defense Capital Dashboard</p>
        <p>Data source: Federal Reserve Economic Data (FRED)</p>
    </footer>

    <script src="../js/main.js"></script>
    <script>
        let chartData = null;

        document.addEventListener('DOMContentLoaded', async function() {
            try {
                // Load data
                const response = await fetch('../data/vc_defense.json');
                chartData = await response.json();

                // Calculate and display stats
                const stats = ChartUtils.calculateStats(chartData.data);
                if (stats) {
                    document.getElementById('dataSummary').style.display = 'block';
                    document.getElementById('latestValue').textContent = ChartUtils.formatNumber(stats.latest.toFixed(2));
                    document.getElementById('latestDate').textContent = stats.latestDate;

                    if (stats.monthChange !== null) {
                        const monthChangeElem = document.getElementById('monthChange');
                        const monthChangePercentElem = document.getElementById('monthChangePercent');
                        monthChangeElem.textContent = (stats.monthChange >= 0 ? '+' : '') + ChartUtils.formatNumber(stats.monthChange.toFixed(2));
                        monthChangePercentElem.textContent = (stats.monthChangePercent >= 0 ? '+' : '') + stats.monthChangePercent.toFixed(2) + '%';
                        monthChangePercentElem.className = 'summary-change ' + (stats.monthChangePercent > 0 ? 'positive' : stats.monthChangePercent < 0 ? 'negative' : 'neutral');
                    }

                    const yearChangeElem = document.getElementById('yearChange');
                    const yearChangePercentElem = document.getElementById('yearChangePercent');
                    yearChangeElem.textContent = (stats.yearChange >= 0 ? '+' : '') + ChartUtils.formatNumber(stats.yearChange.toFixed(2));
                    yearChangePercentElem.textContent = (stats.yearChangePercent >= 0 ? '+' : '') + stats.yearChangePercent.toFixed(2) + '%';
                    yearChangePercentElem.className = 'summary-change ' + (stats.yearChangePercent > 0 ? 'positive' : stats.yearChangePercent < 0 ? 'negative' : 'neutral');

                    document.getElementById('trendIndicator').textContent = stats.trend;
                }

                // Display last updated
                if (chartData.last_updated) {
                    document.getElementById('lastUpdated').textContent = 'Last updated: ' + chartData.last_updated;
                }

                // Filter data to 2019-present for consistent visualization
                // Exception: Annual investment charts (VC, M&A, PDC) show all available data
                const limitedDataCharts = ['public_defense_companies', 'vc_defense', 'ma_defense'];
                let displayData = chartData;

                if (!limitedDataCharts.includes('vc_defense')) {
                    const filteredData = chartData.data.filter(d => new Date(d.date) >= new Date('2019-01-01'));
                    if (filteredData.length > 0) {
                        displayData = {
                            ...chartData,
                            data: filteredData
                        };
                    }
                }

                // Render chart with quarterly labels
                const chartOptions = {
                    fill: true,
                    scales: {
                        x: {
                            ticks: {
                                autoSkip: true,
                                maxRotation: 45,
                                minRotation: 45,
                                maxTicksLimit: 20,
                                callback: function(value, index, ticks) {
                                    // value is the tick value, we need to get the label from the chart
                                    const label = this.getLabelForValue(value);
                                    if (!label) return '';

                                    const d = new Date(label);
                                    const year = d.getFullYear();
                                    const month = d.getMonth(); // 0-11
                                    const quarter = Math.floor(month / 3) + 1;

                                    // Show quarterly labels
                                    return `${year} Q${quarter}`;
                                }
                            }
                        },
                        y: {
                            // Start at zero for investment/dollar amount charts
                            beginAtZero: ['public_defense_companies', 'vc_defense', 'ma_defense', 'dgorder', 'fdefx', 'pnfi', 'gpdi', 'prmfgcons', 'adefno', 'adapno'].includes('vc_defense')
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Value: ${context.parsed.y.toFixed(2)}`;
                                }
                            }
                        }
                    }
                };

                ChartUtils.createLineChart('mainChart', displayData, chartOptions);
            } catch (error) {
                console.error('Error loading chart:', error);
            }

            // Download button handler
            document.getElementById('downloadBtn').addEventListener('click', function() {
                if (chartData) {
                    ChartUtils.downloadCSV(chartData, 'vc_defense.csv');
                }
            });
        });
    </script>
</body>
</html>