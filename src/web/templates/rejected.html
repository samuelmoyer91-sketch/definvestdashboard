{% extends "base.html" %}

{% block title %}Rejected Items - Defense Capital Tracker{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <h2 style="margin: 0;">Rejected Items ({{ items | length }})</h2>
</div>

<p style="color: #666; margin-bottom: 20px;">
    These items were reviewed and rejected as not relevant to defense private capital tracking.
</p>

{% if items | length == 0 %}
<div class="card">
    <p style="text-align: center; color: #666;">
        No items rejected yet.
    </p>
</div>
{% else %}
{% for item in items %}
<div class="card item-card" style="border-left: 4px solid #d94654; opacity: 0.85;">
    <div class="item-header">
        <div class="item-title" style="color: #666;">{{ item.raw_item.title | safe }}</div>
        <div style="display: flex; gap: 8px; align-items: center;">
            <span class="badge" style="background: #d94654; color: white;">Rejected</span>
        </div>
    </div>

    <div class="item-meta" style="margin-bottom: 15px;">
        <span class="badge badge-info">{{ item.raw_item.feed_source }}</span>
        <span style="margin-left: 10px;">Published: {{ item.raw_item.published_date.strftime('%Y-%m-%d') if item.raw_item.published_date else 'Unknown' }}</span>
        <span style="margin-left: 10px;">Rejected: {{ item.rejected_at.strftime('%Y-%m-%d %H:%M') }}</span>
    </div>

    <!-- Pipeline Status -->
    <div style="background: #f8f9fa; padding: 12px; border-radius: 4px; margin-bottom: 15px;">
        <strong style="font-size: 13px; color: #666;">Pipeline Status:</strong>
        <div style="display: flex; gap: 15px; margin-top: 8px; flex-wrap: wrap;">
            <div style="display: flex; align-items: center; gap: 5px;">
                {% if item.article_content and item.article_content.scrape_success %}
                <span style="color: #4c9173;">✓</span>
                <span style="font-size: 13px;">Article Scraped</span>
                <span style="font-size: 12px; color: #999; margin-left: 5px;">({{ "{:,}".format(item.article_content.clean_text | length) }} chars)</span>
                {% else %}
                <span style="color: #999;">✗</span>
                <span style="font-size: 13px; color: #999;">Not Scraped</span>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- RSS Summary -->
    {% if item.raw_item.rss_summary %}
    <div style="margin-top: 12px;">
        <strong style="font-size: 12px; color: #666;">RSS Summary:</strong>
        <div style="font-size: 13px; color: #555; margin-top: 4px; line-height: 1.5;">
            {{ item.raw_item.rss_summary | safe | truncate(300) }}
        </div>
    </div>
    {% endif %}

    <!-- Rejection Reason (if we add this feature later) -->
    {% if item.rejection_reason %}
    <div style="margin-top: 12px; padding: 10px; background: #f8d7da; border-radius: 4px;">
        <strong style="font-size: 12px; color: #721c24;">Rejection Reason:</strong>
        <div style="font-size: 13px; color: #721c24; margin-top: 4px;">{{ item.rejection_reason }}</div>
    </div>
    {% endif %}

    <!-- Article Preview (collapsible) -->
    {% if item.article_content and item.article_content.clean_text %}
    <details style="margin-top: 12px;">
        <summary style="cursor: pointer; font-size: 13px; color: #5e81ac; font-weight: 600;">View Article Text</summary>
        <div style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px; font-size: 12px; max-height: 200px; overflow-y: auto;">
            {{ item.article_content.clean_text | truncate(1000) }}
        </div>
    </details>
    {% endif %}

    <div class="item-actions" style="margin-top: 15px;">
        <a href="{{ item.raw_item.url }}" target="_blank" class="btn btn-link">View Original Article</a>
    </div>
</div>
{% endfor %}
{% endif %}
{% endblock %}
